sudo: required
dist: trusty

os:
  - osx
  - linux

osx_image: xcode9.0

addons:
  apt:
    packages:
      - build-essential
      - libxext-dev
      - libxtst-dev
      - libxkbfile-dev
  artifacts:
    paths:
      - $(ls ./dist/* | tr "\n" ":")
    debug: true

language: node_js
node_js:
- '6'

before_install:
  - ./scripts/travis-xvfb.sh
  - npm install -g gulp
  - npm install

cache:
  directories:
    - node_modules
    - app/node_modules
    - ~/.cache

script:
  - npm run travis
  - chmod +x ./scripts/install-release-dependencies.sh
  - ./scripts/install-release-dependencies.sh
  - npm run dist
  - node ./scripts/prepare-artifacts.js
  # log out /dist files might be useful to know
  # what files are uploaded
  - ls dist

notifications:
  webhooks:
    urls:
      - https://zulip.org/zulipbot/travis
    on_success: always
    on_failure: always
